Com certeza. O **Ngrok** √© uma pe√ßa fundamental para que o sistema receba mensagens do WhatsApp (Webhooks) enquanto roda no seu computador local. Sem ele, a Mega API n√£o consegue "encontrar" o seu computador na internet.

Abaixo est√° o manual completo e detalhado para implanta√ß√£o, desenvolvimento e gera√ß√£o do execut√°vel do **GymZap**.

-----

# üìò Manual de Implanta√ß√£o e Desenvolvimento do Sistema GymZap

Este guia cobre desde a instala√ß√£o dos pr√©-requisitos at√© a cria√ß√£o do execut√°vel final para distribui√ß√£o.

## 1\. Pr√©-requisitos Obrigat√≥rios

Antes de iniciar, certifique-se de que sua m√°quina possui:

1.  **Python 3.x** instalado (marque a op√ß√£o "Add Python to PATH" na instala√ß√£o).
2.  **Ngrok** (Essencial): Ferramenta para expor seu servidor local (localhost) para a internet.
      * *Por que √© necess√°rio?* O sistema precisa receber notifica√ß√µes (Webhooks) da Mega API quando uma mensagem nova chega. A API n√£o consegue acessar `localhost` diretamente; o Ngrok cria um t√∫nel seguro para permitir isso.
3.  **Git** (Opcional, para clonar o reposit√≥rio).

-----

## 2\. Passo a Passo: Instala√ß√£o para Desenvolvimento (CMD)

Siga estes passos para rodar o sistema em modo de desenvolvimento, onde voc√™ pode ver erros e fazer altera√ß√µes no c√≥digo.

### Passo 1: Preparar o Ambiente

1.  Abra o **Prompt de Comando (CMD)** ou Terminal.
2.  Navegue at√© a pasta onde est√£o os arquivos do projeto (onde est√° o `app.py`).
3.  **Crie um Ambiente Virtual** (Isola as bibliotecas do projeto):
    ```cmd
    python -m venv venv
    ```
4.  **Ative o Ambiente Virtual**:
    ```cmd
    venv\Scripts\activate
    ```
    *(Voc√™ ver√° `(venv)` no in√≠cio da linha de comando).*

### Passo 2: Instalar Depend√™ncias

Com o `(venv)` ativo, instale as bibliotecas listadas no `requirements.txt`:

```cmd
pip install -r requirements.txt
```

Isso instalar√° Flask, SQLAlchemy, Pandas, etc..

### Passo 3: Configurar o Banco de Dados

O sistema precisa criar o arquivo `database.db` e o usu√°rio administrador inicial. Execute:

```cmd
flask criar-admin
```

*Isso cria o usu√°rio: `admin` / Senha: `admin123`*.

### Passo 4: Configurar o Ngrok (Cr√≠tico para Webhooks)

1.  Baixe e instale o Ngrok.
2.  Abra um **segundo terminal** (mantenha o primeiro aberto).
3.  Inicie o t√∫nel na porta 5000 (a porta do Flask):
    ```cmd
    ngrok http 5000
    ```
4.  O Ngrok mostrar√° uma URL "Forwarding", ex: `https://a1b2-c3d4.ngrok.io`.
5.  **Copie essa URL**.
6.  V√° no painel da **Mega API** (no site do provedor da API) e configure o Webhook da sua inst√¢ncia para:
    `https://sua-url-ngrok.io/webhook`
    *(Sem isso, o ChatFlow e as Respostas Autom√°ticas n√£o funcionar√£o).*

### Passo 5: Rodar o Sistema

Volte ao primeiro terminal (com `venv` ativo) e inicie o sistema:

```cmd
python app.py
```

O sistema abrir√° automaticamente no navegador em `http://127.0.0.1:5000` (ou voc√™ pode acessar manualmente).

-----

## 3\. Criando o Aplicativo Execut√°vel (.exe)

Para instalar o sistema em outras m√°quinas sem precisar configurar Python ou CMD, voc√™ deve gerar um execut√°vel.

1.  **Instale o PyInstaller** (se ainda n√£o tiver):
    ```cmd
    pip install pyinstaller
    ```
2.  **Gere o Execut√°vel**:
    Utilize o arquivo `GymZap.spec` que j√° cont√©m as configura√ß√µes corretas (como inclus√£o de templates e remo√ß√£o do console preto):
    ```cmd
    pyinstaller GymZap.spec
    ```
3.  **Localize o Arquivo**:
    Ao finalizar, o arquivo `GymZap.exe` estar√° dentro da pasta **`dist`**.
4.  **Distribui√ß√£o**:
    Copie a pasta `dist` (ou apenas o `.exe` se configurado como onefile) para a m√°quina do cliente.
    *Nota: Na m√°quina do cliente, o Ngrok ainda ser√° necess√°rio se voc√™ precisar receber mensagens externas, a menos que a m√°quina tenha um IP p√∫blico fixo.*

-----

## 4\. Detalhamento das Fun√ß√µes do Sistema

O sistema √© dividido em m√≥dulos acess√≠veis pelo menu lateral. Abaixo, o detalhe t√©cnico e funcional de cada um:

### üîê Autentica√ß√£o e Seguran√ßa

  * **Login**: Protege todas as rotas. Usa `Flask-Login` para gest√£o de sess√£o.
  * **Criptografia**: Tokens da API s√£o salvos no banco usando criptografia Fernet (chave sim√©trica) para seguran√ßa extra.

### üìä Dashboard (`/`)

  * **M√©tricas**: Exibe total de mensagens enviadas, entregues e lidas.
  * **Gr√°ficos**: Mostra distribui√ß√£o de envios por M√≥dulo (Boas-vindas vs Cobran√ßa) e por Unidade.

### üí¨ ChatFlow - Inbox (`/chatflow`)

  * **Atendimento Multiusu√°rio**: Interface estilo WhatsApp Web para m√∫ltiplos atendentes.
  * **Funcionalidades**:
      * Ver conversas n√£o lidas, "minhas conversas" ou todas.
      * Atribuir conversa a um agente espec√≠fico.
      * Mudar status (Aberto, Resolvido).
      * Enviar mensagens de texto e respostas r√°pidas.
      * **Recebimento em Tempo Real**: Depende do Webhook (Ngrok) para popular as mensagens recebidas.

### üöÄ Boas-Vindas - Envio em Massa (`/boas-vindas`)

  * **Importa√ß√£o Excel**: L√™ arquivos `.xlsx`.
  * **Preview Din√¢mico**: Substitui vari√°veis (ex: `{ALUNO}`) pelos dados da planilha antes de enviar.
  * **Disparo**: Usa a Mega API para enviar mensagens em fila.

### üí∏ Cobran√ßa Inteligente (`/cobranca`)

  * **L√≥gica de Regras**: Analisa inadimplentes e escolhe automaticamente qual mensagem enviar baseada em:
      * Dias sem acesso.
      * Valor do d√©bito.
      * Tempo de plano.
  * **Configura√ß√£o**: Permite criar r√©guas de cobran√ßa (ex: "D√©bito \> R$100 e 5 dias sem vir = Mensagem A").

### üìù Editores e Configura√ß√µes

  * **Templates (`/templates`)**: Editor visual para criar mensagens com Texto, M√≠dia, Bot√µes e Listas.
  * **Layouts (`/layouts`)**: Mapeia as colunas do Excel do cliente para o sistema (ex: Coluna "Tel Celular" -\> Vari√°vel `telefone`).
  * **Respostas Autom√°ticas (`/respostas`)**: Configura palavras-chave que, se recebidas, disparam uma resposta autom√°tica imediata.
  * **Gest√£o de Usu√°rios e Unidades**: CRUD completo para criar operadores, gerentes e separar as opera√ß√µes por unidade f√≠sica (academia).

-----

## 5\. Resumo de Comandos Necess√°rios

Copie e cole estes comandos conforme a necessidade:

| A√ß√£o | Comando | Observa√ß√£o |
| :--- | :--- | :--- |
| **Criar Ambiente** | `python -m venv venv` | Executar apenas 1 vez na instala√ß√£o |
| **Ativar Ambiente** | `venv\Scripts\activate` | **Sempre** antes de rodar qualquer outro comando |
| **Instalar Pacotes** | `pip install -r requirements.txt` | Se houver erro, tente atualizar o pip antes |
| **Criar Banco** | `flask criar-admin` | Reseta/Cria o DB. Cuidado em produ√ß√£o. |
| **Iniciar Ngrok** | `ngrok http 5000` | Manter janela aberta. Copiar URL HTTPS para a Mega API |
| **Rodar Sistema** | `python app.py` | Acessar via navegador |
| **Criar Execut√°vel**| `pyinstaller GymZap.spec` | Gera arquivo na pasta `dist` |